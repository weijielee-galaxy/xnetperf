# 延迟测试表格显示改进

## 改进内容

将延迟测试结果的显示从列表形式改为表格形式，使用 box-drawing 字符绘制 N×N 矩阵。

## 改进前后对比

### 旧版本（列表形式）
```
================================================================================
📊 Latency Matrix (Average Latency in microseconds)
================================================================================

host1:mlx5_0:
  → host2:mlx5_0: 1.45 μs
  → host3:mlx5_0: 1.52 μs

host2:mlx5_0:
  → host1:mlx5_0: 1.46 μs
  → host3:mlx5_0: 1.50 μs

host3:mlx5_0:
  → host1:mlx5_0: 1.47 μs
  → host2:mlx5_0: 1.51 μs
```

### 新版本（表格形式）
```
================================================================================
📊 Latency Matrix (Average Latency in microseconds)
================================================================================
┌──────────────────────┬──────────────┬──────────────┬──────────────┐
│ Source → Target      │ host1:mlx5_0 │ host2:mlx5_0 │ host3:mlx5_0 │
├──────────────────────┼──────────────┼──────────────┼──────────────┤
│ host1:mlx5_0         │ -            │      1.45 μs │      1.52 μs │
├──────────────────────┼──────────────┼──────────────┼──────────────┤
│ host2:mlx5_0         │      1.46 μs │ -            │      1.50 μs │
├──────────────────────┼──────────────┼──────────────┼──────────────┤
│ host3:mlx5_0         │      1.47 μs │      1.51 μs │ -            │
└──────────────────────┴──────────────┴──────────────┴──────────────┘
```

## 优势

1. **更直观** - 真正的 N×N 矩阵形式，一目了然
2. **易于查找** - 可以快速定位任意两个节点之间的延迟
3. **对称性明显** - 可以轻松对比双向延迟是否对称
4. **易于发现异常** - 异常值在表格中更加突出
5. **与 analyze 命令一致** - 保持整个工具的视觉风格统一

## 表格说明

- **行表头（第一列）**: 源 HCA (发送端)
- **列表头（第一行）**: 目标 HCA (接收端)
- **单元格值**: 平均延迟（微秒）
- **`-` 符号**: 表示自连接（对角线）或缺失数据
- **右对齐**: 延迟数值右对齐，便于数值比较

## 技术实现

### 核心函数
- `displayLatencyMatrix()` - 重写为表格绘制逻辑

### 关键改进
1. 构建二维矩阵数据结构：`map[source]map[target]latency`
2. 计算动态列宽
3. 使用 box-drawing 字符绘制边框：
   - `┌` `┬` `┐` - 顶部边框
   - `├` `┼` `┤` - 中间分隔符
   - `└` `┴` `┘` - 底部边框
   - `│` `─` - 竖线和横线

### 代码示例
```go
// Print table header top border
fmt.Printf("┌─%s─┬", sourceDashes)
for i := range targets {
    if i < len(targets)-1 {
        fmt.Printf("─%s─┬", strings.Repeat("─", targetColWidth))
    } else {
        fmt.Printf("─%s─┐\n", strings.Repeat("─", targetColWidth))
    }
}
```

## 测试覆盖

新增测试用例：
- `TestDisplayLatencyMatrix/Full_N×N_matrix_(3x3)` - 完整 3×3 矩阵测试

所有现有测试用例都已更新并通过。

## 文件变更

### 修改的文件
- `cmd/lat.go` - 重写 `displayLatencyMatrix()` 函数
- `cmd/lat_test.go` - 新增完整矩阵测试用例
- `docs/latency-testing-guide.md` - 更新示例输出
- `docs/v0.2.0-summary.md` - 更新功能说明

### 测试结果
```
✅ All tests passing
✅ Build successful
✅ Table display working correctly
```

## 使用示例

```bash
# 执行延迟测试，将看到新的表格输出
xnetperf lat -c config.yaml
```

输出将显示类似上面展示的表格格式。

## 兼容性

- ✅ 完全向后兼容
- ✅ 不影响其他命令
- ✅ 保持相同的数据结构
- ✅ 仅改变显示格式

## 后续改进建议

1. **颜色标注** - 对高延迟值使用红色高亮
2. **热力图模式** - 使用颜色深浅表示延迟大小
3. **导出功能** - 支持导出为 CSV 或 Excel 格式
4. **对比模式** - 支持多次测试结果的并排对比

---
**更新时间**: 2024-10-20
**版本**: v0.2.0
