# Web UI æ”¹è¿›æ€»ç»“ - v0.0.8

## ç‰ˆæœ¬å·ï¼šv0.0.8

## æ”¹è¿›å†…å®¹

### 1. ç»Ÿä¸€ä½¿ç”¨ snake_case å‘½åè§„èŒƒ

#### é—®é¢˜
ä¹‹å‰ API è¿”å›çš„ JSON ä½¿ç”¨ PascalCaseï¼ˆå¦‚ `StartPort`ï¼‰ï¼Œå¯¼è‡´å‰åç«¯å­—æ®µåä¸ä¸€è‡´ï¼Œå¢åŠ äº†ç»´æŠ¤å¤æ‚åº¦ã€‚

#### è§£å†³æ–¹æ¡ˆ
åœ¨ Go ç»“æ„ä½“ä¸­æ·»åŠ  `json` æ ‡ç­¾ï¼Œç»Ÿä¸€ä½¿ç”¨ snake_caseï¼š

**ä¿®æ”¹æ–‡ä»¶**: `config/config.go`

```go
type Config struct {
    StartPort          int     `yaml:"start_port" json:"start_port"`
    StreamType         string  `yaml:"stream_type" json:"stream_type"`
    QpNum              int     `yaml:"qp_num" json:"qp_num"`
    // ... æ‰€æœ‰å­—æ®µéƒ½æ·»åŠ äº† json æ ‡ç­¾
}

type Report struct {
    Enable bool   `yaml:"enable" json:"enable"`
    Dir    string `yaml:"dir" json:"dir"`
}

type Run struct {
    Infinitely      bool `yaml:"infinitely" json:"infinitely"`
    DurationSeconds int  `yaml:"duration_seconds" json:"duration_seconds"`
}

type ServerConfig struct {
    Hostname []string `yaml:"hostname" json:"hostname"`
    Hca      []string `yaml:"hca" json:"hca"`
}

type ClientConfig struct {
    Hostname []string `yaml:"hostname" json:"hostname"`
    Hca      []string `yaml:"hca" json:"hca"`
}
```

#### æ•ˆæœ
- **API å“åº”æ ¼å¼**ï¼ˆGETï¼‰ï¼š
```json
{
  "code": 0,
  "data": {
    "start_port": 20000,
    "stream_type": "incast",
    "qp_num": 10,
    "server": {
      "hostname": ["server1"],
      "hca": ["mlx5_0"]
    }
  }
}
```

- **å‰ç«¯ä»£ç ç®€åŒ–**ï¼š
```javascript
// ä¹‹å‰éœ€è¦è½¬æ¢ PascalCase
data.StartPort â†’ data.start_port
data.Server.Hostname â†’ data.server.hostname

// ç°åœ¨å®Œå…¨ä¸€è‡´
data.start_port âœ…
data.server.hostname âœ…
```

### 2. æ·»åŠ é…ç½®æ–‡ä»¶é¢„è§ˆåŠŸèƒ½

#### åŠŸèƒ½æè¿°
åœ¨ç¼–è¾‘é…ç½®æ—¶ï¼Œå¯ä»¥å®æ—¶é¢„è§ˆç”Ÿæˆçš„ YAML æ ¼å¼é…ç½®æ–‡ä»¶å†…å®¹ã€‚

#### å®ç°
- æ·»åŠ "ğŸ‘ï¸ é¢„è§ˆ"æŒ‰é’®
- å®ç° YAML æ ¼å¼è½¬æ¢å‡½æ•° `toYAML()`
- ä½¿ç”¨æ¨¡æ€æ¡†æ˜¾ç¤ºé¢„è§ˆå†…å®¹
- æ”¯æŒè¯­æ³•é«˜äº®æ˜¾ç¤º

#### ä½¿ç”¨æ–¹æ³•
1. åœ¨é…ç½®ç¼–è¾‘é¡µé¢ï¼Œç‚¹å‡»å³ä¸Šè§’"ğŸ‘ï¸ é¢„è§ˆ"æŒ‰é’®
2. å¼¹å‡ºé¢„è§ˆçª—å£ï¼Œæ˜¾ç¤ºå½“å‰é…ç½®çš„ YAML æ ¼å¼
3. é¢„è§ˆå†…å®¹å®æ—¶åæ˜ å½“å‰è¡¨å•æ•°æ®
4. ç‚¹å‡»"å…³é—­"æŒ‰é’®é€€å‡ºé¢„è§ˆ

#### ä»£ç å®ç°

**HTML** (`web/static/index.html`):
```html
<!-- é¢„è§ˆæŒ‰é’® -->
<button class="btn btn-default" onclick="app.previewConfig()">
    ğŸ‘ï¸ é¢„è§ˆ
</button>

<!-- é¢„è§ˆæ¨¡æ€æ¡† -->
<div id="previewModal" class="modal">
    <div class="modal-content preview-content">
        <div class="modal-header">é…ç½®æ–‡ä»¶é¢„è§ˆ</div>
        <div class="modal-body">
            <pre id="previewCode" class="preview-code"></pre>
        </div>
        <div class="modal-footer">
            <button class="btn btn-default" onclick="app.hidePreviewDialog()">å…³é—­</button>
        </div>
    </div>
</div>
```

**JavaScript** (`web/static/app.js`):
```javascript
// é¢„è§ˆé…ç½®
previewConfig() {
    if (!this.currentConfig) return;
    
    const data = this.collectFormData();
    const yaml = this.toYAML(data);
    
    document.getElementById('previewCode').textContent = yaml;
    document.getElementById('previewModal').classList.add('show');
}

// YAML è½¬æ¢å‡½æ•°
toYAML(obj, indent = 0) {
    const spaces = '    '.repeat(indent);
    let yaml = '';
    
    for (const [key, value] of Object.entries(obj)) {
        if (value === null || value === undefined) continue;
        
        if (typeof value === 'object' && !Array.isArray(value)) {
            yaml += `${spaces}${key}:\n`;
            yaml += this.toYAML(value, indent + 1);
        } else if (Array.isArray(value)) {
            yaml += `${spaces}${key}:\n`;
            if (value.length === 0) {
                yaml += `${spaces}    []\n`;
            } else {
                value.forEach(item => {
                    yaml += `${spaces}    - ${item}\n`;
                });
            }
        } else {
            yaml += `${spaces}${key}: ${value}\n`;
        }
    }
    
    return yaml;
}
```

### 3. ä»£ç é‡æ„å’Œç®€åŒ–

#### addTag() å’Œ removeTag() ç®€åŒ–
ä¹‹å‰éœ€è¦æ‰‹åŠ¨è½¬æ¢ snake_case åˆ° PascalCaseï¼Œç°åœ¨ç›´æ¥ä½¿ç”¨ï¼š

```javascript
// ä¹‹å‰ï¼ˆå¤æ‚ï¼‰
addTag(type, value) {
    const [sectionLower, fieldLower] = type.split('_');
    const section = sectionLower.charAt(0).toUpperCase() + sectionLower.slice(1);
    const field = fieldLower.charAt(0).toUpperCase() + fieldLower.slice(1);
    this.formData[section][field].push(value);
}

// ç°åœ¨ï¼ˆç®€å•ï¼‰
addTag(type, value) {
    const [section, field] = type.split('_');
    this.formData[section][field].push(value);
}
```

## æµ‹è¯•éªŒè¯

### 1. æµ‹è¯• snake_case ç»Ÿä¸€
```bash
# æµ‹è¯• API è¿”å›æ ¼å¼
curl http://localhost:8080/api/configs/a.yaml | jq '.data | keys'

# åº”è¯¥çœ‹åˆ° snake_case å­—æ®µå
[
  "client",
  "message_size_bytes",
  "output_base",
  "qp_num",
  "rdma_cm",
  "report",
  "run",
  "server",
  "speed",
  "start_port",
  "stream_type",
  "waiting_time_seconds"
]
```

### 2. æµ‹è¯•é¢„è§ˆåŠŸèƒ½
1. è®¿é—® http://localhost:8080
2. é€‰æ‹©æˆ–åˆ›å»ºé…ç½®
3. å¡«å†™è¡¨å•å­—æ®µ
4. ç‚¹å‡»"ğŸ‘ï¸ é¢„è§ˆ"
5. éªŒè¯ YAML æ ¼å¼æ­£ç¡®
6. éªŒè¯æ•°ç»„å­—æ®µæ˜¾ç¤ºæ­£ç¡®ï¼ˆå¦‚ server.hostnameï¼‰

### 3. æµ‹è¯•å®Œæ•´æµç¨‹
1. åˆ›å»ºæ–°é…ç½®
2. å¡«å†™æ‰€æœ‰å­—æ®µï¼ˆåŒ…æ‹¬æ•°ç»„å­—æ®µï¼‰
3. é¢„è§ˆé…ç½®
4. ä¿å­˜é…ç½®
5. é‡æ–°åŠ è½½é…ç½®
6. éªŒè¯æ‰€æœ‰å­—æ®µæ­£ç¡®æ˜¾ç¤º

## ç›¸å…³æ–‡ä»¶

### åç«¯
- `config/config.go` - æ·»åŠ  JSON æ ‡ç­¾

### å‰ç«¯
- `web/static/index.html` - æ·»åŠ é¢„è§ˆæŒ‰é’®å’Œæ¨¡æ€æ¡†
- `web/static/app.js` - å®ç°é¢„è§ˆåŠŸèƒ½å’Œç®€åŒ–ä»£ç 

## API å˜æ›´

æ—  API ç«¯ç‚¹å˜æ›´ï¼Œä»…å“åº”æ ¼å¼å˜æ›´ï¼š

**ä¹‹å‰**:
```json
{
  "data": {
    "StartPort": 20000,
    "Server": {"Hostname": []}
  }
}
```

**ç°åœ¨**:
```json
{
  "data": {
    "start_port": 20000,
    "server": {"hostname": []}
  }
}
```

## å‡çº§è¯´æ˜

1. é‡æ–°ç¼–è¯‘ï¼š`go build -o build/xnetperf`
2. é‡å¯æœåŠ¡å™¨ï¼š`./xnetperf server --port 8080`
3. å¼ºåˆ¶åˆ·æ–°æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+Rï¼‰
4. æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

## æ³¨æ„äº‹é¡¹

- ç¡®ä¿æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œå¦åˆ™å¯èƒ½åŠ è½½æ—§çš„ JavaScript ä»£ç 
- YAML é¢„è§ˆæ˜¯å®¢æˆ·ç«¯ç”Ÿæˆçš„ï¼Œä¸ä¼šä¸æœåŠ¡å™¨é€šä¿¡
- é¢„è§ˆåŠŸèƒ½æ”¯æŒå®æ—¶æŸ¥çœ‹å½“å‰è¡¨å•çŠ¶æ€ï¼Œæ— éœ€ä¿å­˜
