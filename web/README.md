# Web UI 配置管理界面

## 概述

xnetperf 提供了一个现代化的 Web 管理界面，用于可视化管理配置文件。

## 功能特性

### 1. 配置文件列表（左侧面板）
- 📋 显示所有可用的配置文件
- ⭐ 默认配置（config.yaml）用星标标识
- 📄 自定义配置用文档图标标识
- ➕ "新建配置"按钮创建新的配置文件
- 🗑️ 可删除的配置显示删除按钮（默认配置不可删除）

### 2. 配置编辑器（右侧面板）
- 📝 表单化编辑配置，比纯文本编辑更友好
- 🎯 每个字段都有清晰的标签和说明
- 🎨 使用合适的输入控件：
  - **数字输入框**：端口号、队列数量、消息大小等
  - **下拉选择**：stream_type (fullmesh/incast/p2p)
  - **开关按钮**：布尔值（rdma_cm、report.enable、run.infinitely）
  - **标签列表**：hostname 和 hca（支持添加/删除）
  - **文本输入**：目录路径
- ✅ 三个操作按钮：
  - **验证配置**：调用验证 API 检查配置是否合法
  - **取消**：放弃未保存的修改
  - **保存**：保存配置到文件

### 3. 用户体验优化
- ⚠️ 切换配置时，如有未保存内容会弹窗提醒
- ✅ 保存前自动应用默认值
- 🔍 验证失败时显示详细的错误信息
- 💾 保存成功后更新原始数据状态
- 🔄 所有操作都有 Loading 状态反馈

## 启动方式

```bash
# 启动 HTTP 服务器（默认端口 8080）
./xnetperf server

# 或指定端口
./xnetperf server --port 9000
```

## 访问方式

启动服务器后，打开浏览器访问：

```
http://localhost:8080/
```

服务器会自动重定向到 Web UI：`http://localhost:8080/ui/`

## 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│  🚀 xnetperf 配置管理                                        │
├─────────────┬───────────────────────────────────────────────┤
│             │                                               │
│ [+ 新建配置] │  当前配置文件名                                │
│             │  [验证配置] [取消] [保存]                       │
│ ⭐ config.yaml│  ───────────────────────────────────────────  │
│ (选中状态)   │                                               │
│             │  【基础配置】                                   │
│ 📄 test.yaml │  起始端口: [20000      ]                       │
│     🗑️       │  流类型:   [InCast ▼   ]                       │
│             │  ...                                          │
│ 📄 prod.yaml │                                               │
│     🗑️       │  【服务器配置】                                 │
│             │  主机名: [host1] [host2] [+ ]                  │
│             │  HCA:   [mlx5_0] [mlx5_1] [+ ]                │
│             │                                               │
│             │  【客户端配置】                                 │
│             │  ...                                          │
│             │                                               │
└─────────────┴───────────────────────────────────────────────┘
```

## 配置字段说明

### 基础配置
| 字段 | 说明 | 输入类型 | 范围/选项 |
|------|------|----------|-----------|
| start_port | 起始端口号 | 数字输入框 | 1-65535 |
| stream_type | 流类型 | 下拉选择 | fullmesh/incast/p2p |
| qp_num | 队列对数量 | 数字输入框 | ≥1 |
| message_size_bytes | 消息大小（字节）| 数字输入框 | ≥1 |
| output_base | 输出目录 | 文本输入 | - |
| waiting_time_seconds | 等待时间（秒）| 数字输入框 | ≥0 |
| speed | 速度（Gbps）| 数字输入框 | >0 |
| rdma_cm | 使用 RDMA CM | 开关 | true/false |

### 报告配置 (report)
| 字段 | 说明 | 输入类型 |
|------|------|----------|
| enable | 启用报告 | 开关 |
| dir | 报告目录 | 文本输入 |

### 运行配置 (run)
| 字段 | 说明 | 输入类型 | 备注 |
|------|------|----------|------|
| infinitely | 无限运行 | 开关 | - |
| duration_seconds | 运行时长（秒）| 数字输入框 | infinitely=true 时禁用 |

### 服务器/客户端配置
| 字段 | 说明 | 输入类型 |
|------|------|----------|
| hostname | 主机名列表 | 标签列表 |
| hca | HCA 设备列表 | 标签列表 |

## 技术实现

### 前端技术栈
- **Vue 3**：现代化响应式框架
- **Element Plus**：优秀的 UI 组件库
- **纯 CDN 方式**：无需 npm 构建，简单直接

### 后端集成
- **Go embed**：将静态文件嵌入到二进制文件中
- **Gin 框架**：提供静态文件服务
- **RESTful API**：完整的 CRUD 操作

### 文件结构
```
web/
├── embed.go           # Go embed 声明
└── static/            # 静态文件（会被 embed）
    ├── index.html     # 主页面
    └── app.js         # Vue 应用代码
```

## API 调用

Web UI 调用以下 API：

1. `GET /api/configs` - 获取配置列表
2. `GET /api/configs/:name` - 加载配置内容
3. `POST /api/configs` - 创建新配置
4. `PUT /api/configs/:name` - 保存配置
5. `DELETE /api/configs/:name` - 删除配置
6. `POST /api/configs/:name/validate` - 验证配置

## 使用流程示例

### 创建新配置
1. 点击左侧 "➕ 新建配置" 按钮
2. 输入配置文件名（自动添加 .yaml 后缀）
3. 点击"创建"
4. 在右侧编辑器中填写配置项
5. 点击"验证配置"检查是否正确
6. 点击"保存"保存配置

### 编辑现有配置
1. 在左侧列表中点击配置文件名
2. 在右侧编辑器中修改配置
3. 点击"验证配置"（可选）
4. 点击"保存"保存修改
5. 或点击"取消"放弃修改

### 删除配置
1. 鼠标悬停在配置文件上
2. 点击右侧的 🗑️ 删除按钮
3. 确认删除操作
4. 注意：默认配置（config.yaml）无法删除

## 注意事项

1. **默认配置保护**：config.yaml 无法删除，删除按钮会被隐藏
2. **未保存提醒**：切换配置时会检查是否有未保存的修改
3. **自动验证**：建议在保存前先验证配置
4. **标签输入**：hostname 和 hca 字段点击 + 添加，点击 × 删除
5. **无限运行模式**：启用后 duration_seconds 字段会自动禁用

## 优势

相比直接编辑 YAML 文件：

✅ **更直观**：表单化界面，字段一目了然  
✅ **更安全**：输入验证，防止错误配置  
✅ **更便捷**：下拉选择、开关按钮，无需记忆选项  
✅ **更智能**：自动应用默认值，自动验证  
✅ **更友好**：清晰的错误提示和操作反馈  

## 未来改进

- [ ] 支持配置模板
- [ ] 配置对比功能
- [ ] 配置导入/导出
- [ ] 配置历史记录
- [ ] 深色模式
- [ ] 多语言支持
